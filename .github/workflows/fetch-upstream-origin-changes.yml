name: Sync Upstream

on:
  workflow_dispatch:

env:
  UPSTREAM_BRANCH: develop
  UPSTREAM_URL: https://github.com/fiterpaystack/fineract.git
  UPSTREAM_REPO: fiterpaystack/fineract

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 #v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Add upstream remote
        run: git remote add upstream ${{ env.UPSTREAM_URL }}

      - name: Fetch upstream
        run: git fetch upstream

      - name: Create sync branch
        run: |
          git checkout -B sync-upstream upstream/${{ env.UPSTREAM_BRANCH }}
          git push origin sync-upstream --force

      - name: Create PR
        uses: peter-evans/create-pull-request@271a8d0340265f705b14b6d32b9829c1cb33d45e #v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'Sync from ${{ env.UPSTREAM_REPO }} upstream repo'
          branch: sync-upstream
          title: 'ðŸ”„ Sync from ${{ env.UPSTREAM_REPO }}'
          body: 'Sync from upstream repo(${{ env.UPSTREAM_REPO }})'
