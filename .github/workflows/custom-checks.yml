name: Custom folder checks for fineract

on: [push, pull_request]

permissions:
  contents: read

jobs:
  verify:
    runs-on: ubuntu-24.04

    env:
      TZ: Asia/Kolkata
      DEVELOCITY_ACCESS_KEY: ${{ secrets.DEVELOCITY_ACCESS_KEY }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'zulu'

      - name: Cache Gradle dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: gradle-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}

      - name: Setup Gradle and Validate Wrapper
        uses: gradle/actions/setup-gradle@v4.4.1
        with:
          validate-wrappers: true

      - name: Run checks for style checkstylemain and pmd
        run: |
          # Build the JAR
          ./gradlew --no-daemon --console=plain spotlessCheck checkstyleMain spotBugsMain pmdMain

      - name: Run unit tests on the code
        run: |
          # Build the JAR
          ./gradlew --no-daemon --console=plain test -x :integration-tests:test -x spotlessCheck -x checkstyleMain -x spotBugsMain -x pmdMain -x :twofactor-tests:test -x :fineract-e2e-tests-runner:test -x :oauth2-tests:test
